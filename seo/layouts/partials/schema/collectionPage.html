{{- /*
  MODULE: SEO
  (Unused, untested) JSON-LD Schema: CollectionPage
  ---
  Returns schema dictionary for a listing/archive page.
  ---
  Params:
  - .  Page context
*/ -}}

{{- $id := .Permalink -}}
{{- $json := dict
	"@id" $id
	"url" ($.Scratch.Get "Canonical")
	"name" ($.Scratch.Get "OGTitle")
	"description" ($.Scratch.Get "Description")
	"isPartOf" (print site.Home.Permalink "#website")
	"inLanguage" site.LanguageCode
-}}

{{- $type := slice "CollectionPage" -}}
{{- if eq .Params.Layout (site.Params.Seo.SearchPageLayout) -}}
	{{- $type = $type | append "SearchResultsPage" -}}
{{- end -}}
{{- $json = merge $json (dict
	"type" $type
) -}}

{{- $cover := $.Scratch.Get "OGCover" -}}
{{- if $cover -}}
	{{- $imageId := print .Permalink "#primaryimage" -}}

	{{- $license := .Params.Cover.License -}}
	{{- $credit := .Params.Cover.Credit -}}
  {{- /* @NOTE This does not check if path is invalid */ -}}
	{{- with .Params.OGCover.Image -}}
		{{- $license = .Params.OGCover.License -}}
		{{- $credit = .Params.OGCover.Credit -}}
	{{- end -}}
	{{- $image := partialCached "schema/_image.html" (dict
		"Image" $cover
		"License" $license
		"Credit" $credit
	) $cover.RelPermalink -}}
	{{ $image = merge $image (dict
		"@id" $imageId
	) -}}

	{{- $json = merge $json (dict
		"image" $image
		"primaryImageOfPage" (dict "@id" $imageId)
	) -}}
{{- end -}}

{{- return $json -}}
